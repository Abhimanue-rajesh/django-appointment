name: Website Status Check

on:
  schedule:
    - cron: '*/30 * * * *'  # Runs every 30 minutes
  workflow_dispatch:  # Allows manual triggering

jobs:
  check_website:
    runs-on: ubuntu-latest
    steps:
    - name: Check website status
      run: |
        if curl -sSf https://django-appt-doc.adamspierredavid.com > /dev/null; then
          echo "STATUS=up" >> $GITHUB_ENV
          echo "COLOR=brightgreen" >> $GITHUB_ENV
        else
          echo "STATUS=down" >> $GITHUB_ENV
          echo "COLOR=red" >> $GITHUB_ENV
        fi

    - name: Create status badge
      uses: schneegans/dynamic-badges-action@v1.6.0
      with:
        auth: ${{ secrets.GIST_SECRET }}
        gistID: ${{ secrets.GIST_ID }}
        filename: django-appointment-doc-status.json
        label: docs
        message: ${{ env.STATUS }}
        color: ${{ env.COLOR }}
        isError: ${{ env.STATUS == 'down' }}
        namedLogo: django
